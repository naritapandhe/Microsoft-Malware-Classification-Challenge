from pyspark.sql import SparkSession
from pyspark.mllib.linalg import SparseVector, VectorUDT, Vectors
from pyspark.sql.types import *
from pyspark.ml.classification import RandomForestClassifier
from pyspark.ml.evaluation import MulticlassClassificationEvaluator

#initialize spark session
spark = SparkSession\
        .builder\
        .appName("Test")\
        .config('spark.sql.warehouse.dir', 'file:///C:/')\
        .getOrCreate()
sc = spark.sparkContext

#load data
train = spark.read.load("./data/train_small.parquet")
test = spark.read.load("./data/test_small.parquet")

#rf classifier
rf = RandomForestClassifier(numTrees=100,maxDepth=8,seed=42)
model = rf.fit(train)
result = model.transform(test)

print result.show()

#get accuracy
predictionAndLabels = result.select("prediction", "label")
evaluator = MulticlassClassificationEvaluator(metricName="accuracy")
print "Accuracy: " + str(evaluator.evaluate(predictionAndLabels))
